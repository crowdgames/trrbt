---
name: ultimate tic-tac-toe
tree:
  type: sequence
  children:
  - type: set-board
    pattern: = = = = = = = = = = = = =;
             = _ _ _ = _ _ _ = _ _ _ =;
             = _ _ _ = _ _ _ = _ _ _ =;
             = _ _ _ = _ _ _ = _ _ _ =;
             = = = = = = = = = = = = =;
             = _ _ _ = _ _ _ = _ _ _ =;
             = _ _ _ = _ _ _ = _ _ _ =;
             = _ _ _ = _ _ _ = _ _ _ =;
             = = = = = = = = = = = = =;
             = _ _ _ = _ _ _ = _ _ _ =;
             = _ _ _ = _ _ _ = _ _ _ =;
             = _ _ _ = _ _ _ = _ _ _ =;
             = = = = = = = = = = = = =;
  - type: loop-until-all
    nid: gameloop
    children:
    - type: x-ident
      nid: ply
      children:
      - type: player
        pid: X
        children:
        - type: rewrite
          lhs: _
          rhs: X
      - type: loop-until-all
        children:
        - type: x-rotate
          children:
          - type: rewrite
            lhs: = = = = =;
                 = X X X =;
                 = . . . =;
                 = . . . =;
                 = = = = =;
            rhs: = = = = =;
                 = ~ ~ ~ =;
                 = ~ x ~ =;
                 = ~ ~ ~ =;
                 = = = = =;
          - type: rewrite
            lhs: = = = = =;
                 = . . . =;
                 = X X X =;
                 = . . . =;
                 = = = = =;
            rhs: = = = = =;
                 = ~ ~ ~ =;
                 = ~ x ~ =;
                 = ~ ~ ~ =;
                 = = = = =;
          - type: rewrite
            lhs: = = = = =;
                 = . . . =;
                 = . . . =;
                 = X X X =;
                 = = = = =;
            rhs: = = = = =;
                 = ~ ~ ~ =;
                 = ~ x ~ =;
                 = ~ ~ ~ =;
                 = = = = =;
          - type: rewrite
            lhs: = = = = =;
                 = X . . =;
                 = . X . =;
                 = . . X =;
                 = = = = =;
            rhs: = = = = =;
                 = ~ ~ ~ =;
                 = ~ x ~ =;
                 = ~ ~ ~ =;
                 = = = = =;
      - type: win
        pid: X
        children:
        - type: x-rotate
          children:
          - type: x-skew
            children:
            - type: match
              pattern: x . . . x . . . x
    - type: x-set-player
      pid: O
      children:
      - type: x-swap-only
        what: X
        with: O
        children:
        - type: x-swap-only
          what: x
          with: o
          children:
          - type: x-link
            target: ply
