---
name: rush hour-randomize
tree:
  type: sequence
  children:
  - type: loop-until-all
    children:
    - type: none
      children:
      - type: sequence
        children:
        - type: set-board
          comment: reset board
          pattern: XX XX XX XX XX XX XX XX;
                   XX __ __ __ __ __ __ XX;
                   XX __ __ __ __ __ __ XX;
                   XX __ __ __ __ CR CR OO;
                   XX __ __ __ __ __ __ XX;
                   XX __ __ __ __ __ __ XX;
                   XX __ __ __ __ __ __ XX;
                   XX XX XX XX XX XX XX XX;
        - type: sequence
          comment: place cars and trucks randomly
          children:
          - type: rewrite
            lhs: __; __
            rhs: C1; C1
          - type: rewrite
            lhs: __; __; __
            rhs: T1; T1; T1
          - type: rewrite
            lhs: __ __
            rhs: C2 C2
          - type: rewrite
            lhs: __ __ __
            rhs: T2 T2 T2
          - type: rewrite
            lhs: __; __
            rhs: C3; C3
          - type: rewrite
            lhs: __; __; __
            rhs: T3; T3; T3
        - type: loop-times
          comment: shuffle cars and trucks
          times: 20
          children:
          - type: rewrite
            lhs: __ CR CR
            rhs: CR CR __
          - type: random-try
            children:
            - type: x-link
              target: move
    - type: none
      children:
      - type: match
        pattern: XX CR CR
    - type: match
      pattern: CR CR __ __ __ __ OO
  - type: x-file
    file: rushhour
    target: gameloop
