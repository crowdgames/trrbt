---
name: checkers
tree:
  type: order
  children:
  - type: set-board
    pattern: =  =  =  =  =  =  =  = ;
             _  RP _  RP _  RP _  RP;
             RP _  RP _  RP _  RP _ ;
             _  RP _  RP _  RP _  RP;
             _  _  _  _  _  _  _  _ ;
             _  _  _  _  _  _  _  _ ;
             BP _  BP _  BP _  BP _ ;
             _  BP _  BP _  BP _  BP;
             BP _  BP _  BP _  BP _ ;
             =  =  =  =  =  =  =  = ;
  - type: loop-until-all
    nid: gameloop
    children:
    - type: x-mirror
      children:
      - type: x-replace-only
        what: a
        withs:
        - K
        - P
        children:
        - type: x-replace-only
          what: b
          withs:
          - K
          - P
          children:
          - type: x-ident
            nid: ply
            children:
            - type: none
              comment: player loses if no move
              children:
              - type: lose
                pid: B
                children:
                - type: none
                  children:
                  - type: order
                    children:
                    - type: player
                      pid: B
                      children:
                      - type: rewrite
                        lhs: .   .   _  ;
                             .   Rb  .  ;
                             Ba  .   .  ;
                        rhs: .   .   Ba';
                             .   _   .  ;
                             _   .   .  ;
                      - type: rewrite
                        lhs: BK  .   .  ;
                             .   Rb  .  ;
                             .   .   _  ;
                        rhs: _   .   .  ;
                             .   _   .  ;
                             .   .   BK';
                    - type: loop-until-all
                      children:
                      - type: player
                        pid: B
                        children:
                        - type: rewrite
                          lhs: .   .   _  ;
                               .   Rb  .  ;
                               Ba' .   .  ;
                          rhs: .   .   Ba';
                               .   _   .  ;
                               _   .   .  ;
                        - type: rewrite
                          lhs: BK'  .  .  ;
                               .   Rb  .  ;
                               .   .   _  ;
                          rhs: _   .   .  ;
                               .   _   .  ;
                               .   .   BK';
                    - type: rewrite
                      lhs: Ba'
                      rhs: Ba
                  - type: player
                    pid: B
                    children:
                    - type: rewrite
                      lhs: .   _ ;
                           Ba  . ;
                      rhs: .   Ba;
                           _   . ;
                    - type: rewrite
                      lhs: BK . ;
                           .  _ ;
                      rhs: _  . ;
                           .  BK;
            - type: rewrite
              lhs: =  ; BP
              rhs: =  ; BK
            - type: win
              pid: B
              children:
               - type: none
                 children:
                 - type: match
                   pattern: Ra
          - type: x-swap-only
            what: B
            with: R
            children:
            - type: x-flip-only
              children:
              - type: x-link
                target: ply
