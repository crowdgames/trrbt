---
name: checkers
tree:
  type: sequence
  children:
  - type: set-board
    pattern: =  =  =  =  =  =  =  = ;
             _  BP _  BP _  BP _  BP;
             BP _  BP _  BP _  BP _ ;
             _  BP _  BP _  BP _  BP;
             _  _  _  _  _  _  _  _ ;
             _  _  _  _  _  _  _  _ ;
             RP _  RP _  RP _  RP _ ;
             _  RP _  RP _  RP _  RP;
             RP _  RP _  RP _  RP _ ;
             =  =  =  =  =  =  =  = ;
  - type: x-mirror
    children:
    - type: x-replaceonly
      what: a
      with:
      - K
      - P
      children:
      - type: x-replaceonly
        what: b
        with:
        - K
        - P
        children:
        - type: loop-until-all
          children:
          - type: x-ident
            nid: ply
            children:
            - type: none
              comment: player loses if no move
              children:
              - type: lose
                pid: X
                children:
                - type: none
                  children:
                  - type: player
                    pid: R
                    children:
                    - type: rewrite
                      lhs: .   _ ;
                           Ra  . ;
                      rhs: .   Ra;
                           _   . ;
                    - type: rewrite
                      lhs: RK . ;
                           .  _ ;
                      rhs: _  . ;
                           .  RK;
                    - type: rewrite
                      lhs: .   .   _  ;
                           .   Bb  .  ;
                           Ra  .   .  ;
                      rhs: .   .   Ra';
                           .   _   .  ;
                           _   .   .  ;
                    - type: rewrite
                      lhs: RK  .   .  ;
                           .   Bb  .  ;
                           .   .   _  ;
                      rhs: _   .   .  ;
                           .   _   .  ;
                           .   .   RK';
            - type: loop-until-all
              children:
              - type: player
                pid: R
                children:
                - type: rewrite
                  lhs: .   .   _  ;
                       .   Bb  .  ;
                       Ra' .   .  ;
                  rhs: .   .   Ra';
                       .   _   .  ;
                       _   .   .  ;
                - type: rewrite
                  lhs: RK'  .  .  ;
                       .   Bb  .  ;
                       .   .   _  ;
                  rhs: _   .   .  ;
                       .   _   .  ;
                       .   .   RK';
            - type: rewrite
              lhs: Ra'
              rhs: Ra
            - type: rewrite
              lhs: =  ; RP
              rhs: =  ; RK
            - type: win
              pid: R
              children:
               - type: none
                 children:
                 - type: match
                   pattern: Ba
          - type: x-set-player
            pid: B
            children:
            - type: x-fliponly
              children:
              - type: x-swaponly
                what: R
                with: B
                children:
                - type: x-link
                  target: ply
