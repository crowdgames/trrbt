---
name: rust
tree:
  type: order
  children:
  - type: set-board
    pattern: .  .  .  .  X  X  X  X  X;
             .  .  .  .  X  _  _  _  X;
             .  .  .  .  X  _  P  _  X;
             .  .  .  .  X  _  _  _  X;
             .  .  .  .  .  .  _  .  .;
             .  .  .  .  B  _  _  .  .;
             .  .  .  .  _  .  .  .  .;
             X  _  _  _  _  _  _  _  X;
             X  _  _  _  _  _  _  _  X;
             X  _  _  X  X  X  _  _  X;
             X  _  _  _  E  _  _  _  X;
             X  _  _  _  _  _  _  _  X;
             .  .  .  .  B  .  .  .  .;
             X  _  _  _  _  _  _  _  X;
             X  _  _  _  X  _  _  _  X;
             X  _  E  _  X  _  E  _  X;
             X  _  _  _  X  _  _  _  X;
             X  _  _  _  _  _  _  _  X;
             .  .  .  .  _  .  .  .  .;
             .  .  .  .  B  _  B  .  .;
             .  .  .  .  .  .  _  .  .;
             .  .  .  .  X  _  _  _  X;
             .  .  .  .  X  _  O  _  X;
             .  .  .  .  X  _  _  _  X;
             .  .  .  .  X  X  X  X  X;
  - type: loop-until-all
    nid: gameloop
    children:
    - type: x-replace-only
      what: a
      with:
      - _
      - E
      - F
      children:
      - type: x-replace-only
        what: b
        with:
        - _
        - E
        - F
        children:
        - type: x-replace-only
          what: d
          with:
          - '<'
          - '>'
          - ^
          - v
          children:
          - type: x-spin
            children:
            - type: player
              pid: 1
              children:
              - type: rewrite
                lhs: P
                rhs: P
              - type: rewrite
                lhs: P  _
                rhs: R  P
              - type: rewrite
                lhs: P  O
                rhs: _  W
              - type: rewrite
                lhs: P  B
                rhs: P  _
              - type: rewrite
                lhs: P  E
                rhs: P  _
              - type: rewrite
                lhs: P  F
                rhs: P  _
          - type: loop-until-all
            children:
            - type: rewrite
              lhs: P  a
              rhs: P  a:<
            - type: rewrite
              lhs: a    P
              rhs: a:>  P
            - type: rewrite
              lhs: P;  a
              rhs: P;  a:^
            - type: rewrite
              lhs: a  ; P
              rhs: a:v; P
          - type: loop-until-all
            children:
            - type: rewrite
              lhs: R  a
              rhs: R  a:<
            - type: rewrite
              lhs: a    R
              rhs: a:>  R
            - type: rewrite
              lhs: R;  a
              rhs: R;  a:^
            - type: rewrite
              lhs: a  ; R
              rhs: a:v; R
          - type: loop-until-all
            children:
            - type: rewrite
              lhs: P  R
              rhs: P  _:<
            - type: rewrite
              lhs: R    P
              rhs: _:>  P
            - type: rewrite
              lhs: P;  R
              rhs: P;  _:^
            - type: rewrite
              lhs: R  ; P
              rhs: _:v; P
          - type: loop-until-all
            children:

            - type: x-ident
              nid: arrow-equal
              children:
              - type: loop-until-all
                children:
                - type: x-spin
                  children:
                  - type: rewrite
                    lhs: a:< b
                    rhs: a:< b:=
                  - type: rewrite
                    lhs: a:> b
                    rhs: a:> b:=
                  - type: rewrite
                    lhs: a:^ b
                    rhs: a:^ b:=
                  - type: rewrite
                    lhs: a:v b
                    rhs: a:v b:=

            - type: x-ident
              nid: arrow-left-right
              children:
              - type: loop-until-all
                children:
                - type: rewrite
                  lhs: a:< b:=
                  rhs: a:< b:<
                - type: rewrite
                  lhs: a:^ b:=
                  rhs: a:^ b:<
                - type: rewrite
                  lhs: a:v b:=
                  rhs: a:v b:<

                - type: rewrite
                  lhs: a:= b:>
                  rhs: a:> b:>
                - type: rewrite
                  lhs: a:= b:^
                  rhs: a:> b:^
                - type: rewrite
                  lhs: a:= b:v
                  rhs: a:> b:v

            - type: x-ident
              nid: arrow-up-down
              children:
              - type: loop-until-all
                children:
                - type: rewrite
                  lhs: a:<; b:=
                  rhs: a:<; b:^
                - type: rewrite
                  lhs: a:>; b:=
                  rhs: a:>; b:^
                - type: rewrite
                  lhs: a:^; b:=
                  rhs: a:^; b:^

                - type: rewrite
                  lhs: a:=; b:<
                  rhs: a:v; b:<
                - type: rewrite
                  lhs: a:=; b:>
                  rhs: a:v; b:>
                - type: rewrite
                  lhs: a:=; b:v
                  rhs: a:v; b:v
            - type: x-link
              target: arrow-equal
            - type: x-link
              target: arrow-up-down
            - type: x-link
              target: arrow-left-right
          - type: order
            children:
            - type: rewrite
              lhs: P  E:<
              rhs: E' _:<
            - type: rewrite
              lhs: E:> P
              rhs: _:> E'
            - type: rewrite
              lhs: P ; E:^
              rhs: E'; _:^
            - type: rewrite
              lhs: E:v; P
              rhs: _:v; E'
          - type: loop-until-all
            children:
            - type: rewrite
              lhs: _:d E:<
              rhs: E'  _:<
            - type: rewrite
              lhs: E:> _:d
              rhs: _:> E'
            - type: rewrite
              lhs: _:d; E:^
              rhs: E' ; _:^
            - type: rewrite
              lhs: E:v; _:d
              rhs: _:v; E'
          - type: loop-until-all
            children:
            - type: rewrite
              lhs: E'
              rhs: E
            - type: rewrite
              lhs: a:d
              rhs: a
          - type: loop-until-all
            children:
            - type: rewrite
              lhs: F
              rhs: E'
            - type: rewrite
              lhs: E
              rhs: F'
          - type: loop-until-all
            children:
            - type: rewrite
              lhs: E'
              rhs: E
            - type: rewrite
              lhs: F'
              rhs: F
          - type: win
            pid: 1
            children:
            - type: match
              pattern: W
          - type: lose
            pid: 1
            children:
            - type: none
              children:
              - type: match
                pattern: P
