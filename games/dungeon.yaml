---
name: dungeon
tree:
  type: sequence
  children:
  - type: set-board
    pattern: X  X  X  X  X  X  X  X  X  X;
             X  PN _  _  _  _  _  X  _  X;
             X  _  _  _  _  _  _  D  _  X;
             X  _  _  _  _  _  _  X  _  X;
             X  _  _  _  _  _  _  X  _  X;
             X  _  _  _  K  _  _  X  O  X;
             X  X  X  X  X  X  X  X  X  X;
  - type: loop-until-all
    nid: gameloop
    children:
    - type: x-replace-only
      comment: player inventory is nothing or key
      what: i
      with:
      - N
      - K
      children:
      - type: player
        pid: 1
        children:
        - type: rewrite
          comment: player stays still
          lhs: Pi
          rhs: Pi
        - type: x-spin
          comment: player moves
          children:
          - type: rewrite
            lhs: Pi _
            rhs: _  Pi
          - type: rewrite
            lhs: Pi O
            rhs: _  W
        - type: x-spin
          comment: player gets or uses key
          children:
          - type: rewrite
            lhs: PN K
            rhs: _  PK
          - type: rewrite
            lhs: PK D
            rhs: _  PN
      - type: x-link
        target: plugin
      - type: win
        pid: 1
        children:
        - type: match
          pattern: W
      - type: lose
        pid: 1
        children:
        - type: none
          children:
          - type: match
            pattern: Pi
